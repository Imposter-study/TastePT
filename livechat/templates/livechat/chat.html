<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>채팅방</title>
    <style>
        body { font-family: Arial, sans-serif; }
        #chat-log { width: 400px; height: 300px; border: 1px solid #ccc; overflow-y: auto; padding: 10px; }
        .message { padding: 5px; margin: 5px 0; border-radius: 5px; }
        .my-message { background-color: #d1e7dd; text-align: right; }
        .other-message { background-color: #f8d7da; text-align: left; }
    </style>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const urlParams = new URLSearchParams(window.location.search);
            const roomId = urlParams.get("room_id");

            if (!roomId) {
                alert("잘못된 채팅방 ID입니다.");
                window.location.href = "index.html"; // 채팅방 목록 페이지로 이동
                return;
            }

            document.getElementById("room-title").innerText = `채팅방: ${roomId}`;
            const userName = prompt("사용자 이름을 입력하세요") || "익명"; 

            const protocol = window.location.protocol === "https:" ? "wss://" : "ws://";
            const ws = new WebSocket(`${protocol}${window.location.host}/ws/chat/${roomId}/`);

            ws.onmessage = function(event) {
                const data = JSON.parse(event.data);
                const chatLog = document.getElementById("chat-log");

                const messageDiv = document.createElement("div");
                messageDiv.classList.add("message");
                messageDiv.classList.add(data.user === userName ? "my-message" : "other-message");
                messageDiv.innerHTML = `<strong>${data.user}:</strong> ${data.message}`;

                chatLog.appendChild(messageDiv);
                chatLog.scrollTop = chatLog.scrollHeight;
            };

            document.getElementById("chat-message-submit").onclick = function() {
                const messageInput = document.getElementById("chat-message-input");
                const message = messageInput.value.trim();

                if (message) {
                    ws.send(JSON.stringify({ user: userName, message: message }));
                    messageInput.value = "";
                }
            };
        });
    </script>
</head>
<body>
    <h1 id="room-title">채팅방</h1>
    <div id="chat-log"></div>
    <input id="chat-message-input" type="text">
    <button id="chat-message-submit">보내기</button>
</body>
</html>
